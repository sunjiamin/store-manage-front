webpackJsonp([18],{"D+CQ":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("mvHQ"),l=i.n(s),o={name:"role-manage",data:function(){var e=this;return{loading:!0,treeLoading:!0,submitPermLoading:!1,sortColumn:"createTime",sortType:"desc",modalType:0,roleModalVisible:!1,permModalVisible:!1,modalTitle:"",roleForm:{name:""},roleFormValidate:{name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}]},submitLoading:!1,selectList:[],selectCount:0,columns:[{type:"selection",width:60,align:"center"},{title:"角色名称",key:"name",sortable:!0},{title:"创建时间",key:"createTime",sortable:!0,sortType:"desc"},{title:"更新时间",key:"updateTime",sortable:!0},{title:"是否设置为注册用户默认角色",key:"defaultRole",align:"center",render:function(t,i){return i.row.defaultRole?t("div",[t("Button",{props:{type:"success",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.cancelDefault(i.row)}}},"取消默认")]):t("div",[t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.setDefault(i.row)}}},"设为默认")])}},{title:"操作",key:"action",align:"center",width:300,render:function(t,i){return t("div",[t("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.editPerm(i.row)}}},"分配权限"),t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.edit(i.row)}}},"编辑"),t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.remove(i.row)}}},"删除")])}}],data:[],pageNumber:1,pageSize:10,total:0,permData:[],editRolePermId:"",selectPermList:[],selectAllFlag:!1}},methods:{init:function(){this.getRoleList(),this.getPermList()},changePage:function(e){this.pageNumber=e,this.getRoleList()},changePageSize:function(e){this.pageSize=e,this.getRoleList()},changeSort:function(e){this.sortColumn=e.key,this.sortType=e.order,"normal"===e.order&&(this.sortType=""),this.getRoleList()},getRoleList:function(){var e=this;this.loading=!0;var t={pageNumber:this.pageNumber,pageSize:this.pageSize,sort:"createTime"};this.getRequest("/role/getAllByPage",t).then(function(t){e.loading=!1,!0===t.success&&(e.data=t.result.content,e.total=t.result.totalElements)})},getPermList:function(){var e=this;this.treeLoading=!0,this.getRequest("/permission/getAllList").then(function(t){e.treeLoading=!1,!0===t.success&&(e.deleteDisableNode(t.result),e.permData=t.result)})},deleteDisableNode:function(e){var t=this;e.forEach(function(e){1===e.status&&(e.title+="(已禁用)",e.disabled=!0),e.children&&e.children.length>0&&t.deleteDisableNode(e.children)})},cancelRole:function(){this.roleModalVisible=!1},submitRole:function(){var e=this;this.$refs.roleForm.validate(function(t){if(t){var i="/role/save";1===e.modalType&&(i="/role/edit"),e.submitLoading=!0,e.postRequest(i,e.roleForm).then(function(t){e.submitLoading=!1,!0===t.success&&(e.$Message.success("操作成功"),e.init(),e.roleModalVisible=!1)})}})},addRole:function(){this.modalType=0,this.modalTitle="添加角色",this.roleForm={name:"",access:null},this.roleModalVisible=!0},edit:function(e){for(var t in this.modalType=1,this.modalTitle="编辑角色",e)null===e[t]&&(e[t]="");var i=l()(e),s=JSON.parse(i);this.roleForm=s,this.roleModalVisible=!0},remove:function(e){var t=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除角色 "+e.name+" ?",onOk:function(){t.deleteRequest("/role/delAllByIds",{ids:e.id}).then(function(e){!0===e.success&&(t.$Message.success("删除成功"),t.init())})}})},setDefault:function(e){var t=this;this.$Modal.confirm({title:"确认设置",content:"您确认要设置所选的 "+e.name+" 为注册用户默认角色?",onOk:function(){var i={id:e.id,isDefault:!0};t.postRequest("/role/setDefault",i).then(function(e){!0===e.success&&(t.$Message.success("操作成功"),t.init())})}})},cancelDefault:function(e){var t=this;this.$Modal.confirm({title:"确认取消",content:"您确认要取消所选的 "+e.name+" 角色为默认?",onOk:function(){var i={id:e.id,isDefault:!1};t.postRequest("/role/setDefault",i).then(function(e){!0===e.success&&(t.$Message.success("操作成功"),t.init())})}})},clearSelectAll:function(){this.$refs.table.selectAll(!1)},changeSelect:function(e){this.selectList=e,this.selectCount=e.length},delAll:function(){var e=this;this.selectCount<=0?this.$Message.warning("您还未选择要删除的数据"):this.$Modal.confirm({title:"确认删除",content:"您确认要删除所选的 "+this.selectCount+" 条数据?",onOk:function(){var t="";e.selectList.forEach(function(e){t+=e.id+","}),t=t.substring(0,t.length-1),e.deleteRequest("/role/delAllByIds",{ids:t}).then(function(t){!0===t.success&&(e.$Message.success("删除成功"),e.init())})}})},editPerm:function(e){this.editRolePermId=e.id;var t=e.permissions;this.checkPermTree(this.permData,t),this.permModalVisible=!0},checkPermTree:function(e,t){var i=this;e.forEach(function(e){i.hasPerm(e,t)?e.selected=!0:e.selected=!1,e.children&&e.children.length>0&&i.checkPermTree(e.children,t)})},hasPerm:function(e,t){for(var i=!1,s=0;s<t.length;s++)if(e.id===t[s].id){i=!0;break}return!!i},selectTreeAll:function(){this.selectAllFlag=!this.selectAllFlag;var e=this.selectAllFlag;this.selectedTreeAll(this.permData,e)},selectedTreeAll:function(e,t){var i=this;e.forEach(function(e){e.selected=t,e.children&&e.children.length>0&&i.selectedTreeAll(e.children,t)})},submitPermEdit:function(){var e=this;this.submitPermLoading=!0;var t="";this.$refs.tree.getSelectedNodes().forEach(function(e){t+=e.id+","}),t=t.substring(0,t.length-1),this.postRequest("/role/editRolePerm/"+this.editRolePermId,{permIds:t}).then(function(t){e.submitPermLoading=!1,!0===t.success&&(e.$Message.success("操作成功"),e.init(),e.permModalVisible=!1)})},cancelPermEdit:function(){this.permModalVisible=!1}},mounted:function(){this.init()}},n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"search"},[i("Row",[i("Col",[i("Card",[i("Row",{staticClass:"operation"},[i("Button",{attrs:{type:"primary",icon:"plus-round"},on:{click:e.addRole}},[e._v("添加角色")]),e._v(" "),i("Button",{attrs:{type:"ghost",icon:"trash-a"},on:{click:e.delAll}},[e._v("批量删除")]),e._v(" "),i("Button",{attrs:{type:"ghost",icon:"refresh"},on:{click:e.init}},[e._v("刷新")])],1),e._v(" "),i("Row",[i("Alert",{attrs:{"show-icon":""}},[e._v("\n                        已选择 "),i("span",{staticClass:"select-count"},[e._v(e._s(e.selectCount))]),e._v(" 项\n                        "),i("a",{staticClass:"select-clear",on:{click:e.clearSelectAll}},[e._v("清空")])])],1),e._v(" "),i("Row",{staticClass:"margin-top-10 searchable-table-con1"},[i("Table",{ref:"table",attrs:{loading:e.loading,border:"",columns:e.columns,data:e.data,sortable:"custom"},on:{"on-sort-change":e.changeSort,"on-selection-change":e.changeSelect}})],1),e._v(" "),i("Row",{staticClass:"code-row-bg page",attrs:{type:"flex",justify:"end"}},[i("Page",{attrs:{current:this.pageNumber,total:e.total,"page-size":this.pageSize,"page-size-opts":[10,20,50,100],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1)],1)],1),e._v(" "),i("Modal",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500},model:{value:e.roleModalVisible,callback:function(t){e.roleModalVisible=t},expression:"roleModalVisible"}},[i("Form",{ref:"roleForm",attrs:{model:e.roleForm,"label-width":80,rules:e.roleFormValidate}},[i("FormItem",{attrs:{label:"角色名称",prop:"name"}},[i("Input",{attrs:{placeholder:"按照Spring Security约定建议以‘ROLE_’开头"},model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name",t)},expression:"roleForm.name"}})],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:e.cancelRole}},[e._v("取消")]),e._v(" "),i("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submitRole}},[e._v("提交")])],1)],1),e._v(" "),i("Modal",{attrs:{title:"分配权限(点击选择)","mask-closable":!1,width:500},model:{value:e.permModalVisible,callback:function(t){e.permModalVisible=t},expression:"permModalVisible"}},[i("Tree",{ref:"tree",attrs:{data:e.permData,multiple:""}}),e._v(" "),e.treeLoading?i("Spin",{attrs:{size:"large"}}):e._e(),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:e.cancelPermEdit}},[e._v("取消")]),e._v(" "),i("Button",{attrs:{type:"ghost"},on:{click:e.selectTreeAll}},[e._v("全选/反选")]),e._v(" "),i("Button",{attrs:{type:"primary",loading:e.submitPermLoading},on:{click:e.submitPermEdit}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var a=i("VU/8")(o,n,!1,function(e){i("EVEq")},null,null);t.default=a.exports},EVEq:function(e,t){}});
//# sourceMappingURL=18.64a73a14548fb8431ea2.js.map